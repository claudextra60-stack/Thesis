<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Engineering Drawing Visualizer - VR Edition</title>
  
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; }

    #intro-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(45deg, #2B2B88 0%, #2B2B88 25%, #CF2027 25%, #CF2027 50%, #B78A2D 50%, #B78A2D 75%, #5CCAE8 75%, #5CCAE8 100%);
      background-size: 100px 100px;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      z-index: 10000; transition: opacity 0.8s ease-out;
    }
    
    #intro-overlay::before {
      content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(255, 255, 255, 0.85); z-index: -1;
    }

    #intro-overlay.hidden { opacity: 0; pointer-events: none; }

    .logo-container {
      margin-bottom: 40px; padding: 30px; background: white;
      border: 8px solid #2B2B88; border-radius: 20px;
      box-shadow: 0 0 0 4px #CF2027, 0 0 0 8px #B78A2D, 0 20px 50px rgba(0,0,0,0.3);
    }

    #bits-logo { width: 300px; height: auto; display: block; }

    .title-container {
      text-align: center; margin: 30px 0; padding: 30px 50px; background: white;
      border: 6px solid #2B2B88; border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .intro-title {
      font-size: 3.5em; font-weight: 900; color: #2B2B88; text-transform: uppercase;
      letter-spacing: 4px; margin: 10px 0; text-shadow: 3px 3px 0 #CF2027, 6px 6px 0 #B78A2D;
    }

    .intro-subtitle {
      font-size: 1.8em; font-weight: 700; color: #CF2027; text-transform: uppercase;
      letter-spacing: 3px; margin-top: 15px; border-top: 4px solid #5CCAE8; padding-top: 15px;
    }

    .start-button {
      padding: 25px 80px; font-size: 1.5em; font-weight: 900; color: white;
      background: #CF2027; border: 6px solid #2B2B88; border-radius: 15px;
      cursor: pointer; text-transform: uppercase; letter-spacing: 3px;
      box-shadow: 0 0 0 3px #B78A2D, 0 15px 40px rgba(0,0,0,0.4);
      transition: all 0.2s ease; margin-top: 40px;
    }

    .start-button:hover {
      background: #2B2B88; border-color: #CF2027; transform: scale(1.05);
      box-shadow: 0 0 0 3px #5CCAE8, 0 20px 50px rgba(0,0,0,0.5);
    }

    .corner-block { position: absolute; width: 100px; height: 100px; border: 5px solid; }
    .corner-block.top-left { top: 20px; left: 20px; border-color: #2B2B88 transparent transparent #2B2B88; border-radius: 10px 0 0 0; }
    .corner-block.top-right { top: 20px; right: 20px; border-color: #CF2027 #CF2027 transparent transparent; border-radius: 0 10px 0 0; }
    .corner-block.bottom-left { bottom: 20px; left: 20px; border-color: transparent transparent #B78A2D #B78A2D; border-radius: 0 0 0 10px; }
    .corner-block.bottom-right { bottom: 20px; right: 20px; border-color: transparent #5CCAE8 #5CCAE8 transparent; border-radius: 0 0 10px 0; }
  </style>
</head>

<body>
  <!-- INTRO OVERLAY -->
  <div id="intro-overlay">
    <div class="corner-block top-left"></div>
    <div class="corner-block top-right"></div>
    <div class="corner-block bottom-left"></div>
    <div class="corner-block bottom-right"></div>
    
    <div class="logo-container">
      <img id="bits-logo" src="https://i.ibb.co/6cSQR6Tt/1200px-BITS-Pilani-Logo-svg.png" alt="BITS Pilani">
    </div>
    
    <div class="title-container">
      <h1 class="intro-title">Engineering Drawing<br>Visualizer</h1>
      <p class="intro-subtitle">Virtual Reality Edition</p>
    </div>
    
    <button class="start-button" id="start-btn">Start Experience</button>
  </div>

  <!-- VR SCENE -->
  <a-scene id="vr-scene" style="display: none;"
    webxr="requiredFeatures: hand-tracking; optionalFeatures: local-floor, bounded-floor;">
    
    <a-assets timeout="8000">
      <img id="wall-texture" src="https://cdn.architextures.org/textures/23/10/plain-blue-sheer-twinbru-textiles-1yeo48.jpg" crossorigin="anonymous">
      <img id="carpet-texture" src="https://cdn.architextures.org/textures/23/7/plain-green-texture-none-twinbru-textiles-9cbkkg.jpg" crossorigin="anonymous">
      <img id="ceiling-texture" src="https://cdn.architextures.org/textures/23/7/plain-pink-texture-none-twinbru-textiles-yvcpnl.jpg" crossorigin="anonymous">
      <a-asset-item id="plant-model" src="https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models@master/2.0/Avocado/glTF/Avocado.gltf"></a-asset-item>
    </a-assets>

    <a-sky color="#E8F4F8"></a-sky>
    
    <!-- LIGHTING -->
    <a-entity light="type: ambient; intensity: 0.8; color: #FFFFFF"></a-entity>
    <a-entity light="type: directional; intensity: 1.0; color: #FFFFFF" position="0 10 0"></a-entity>

    <!-- FLOOR -->
    <a-plane 
      position="0 0 0" 
      rotation="-90 0 0" 
      width="20" 
      height="20" 
      color="#8B7355"
      src="#carpet-texture"
      repeat="4 4">
    </a-plane>

    <!-- WALLS -->
    <a-plane position="0 3 -10" rotation="0 0 0" width="20" height="6" src="#wall-texture" repeat="4 2"></a-plane>
    <a-plane position="-10 3 0" rotation="0 90 0" width="20" height="6" src="#wall-texture" repeat="4 2"></a-plane>
    <a-plane position="10 3 0" rotation="0 -90 0" width="20" height="6" src="#wall-texture" repeat="4 2"></a-plane>

    <!-- CEILING -->
    <a-plane 
      position="0 6 0" 
      rotation="90 0 0" 
      width="20" 
      height="20" 
      src="#ceiling-texture"
      repeat="4 4">
    </a-plane>

    <!-- EXIT BUTTON ON FRONT (opposite wall) -->
    <a-entity id="exit-button" position="0 2 9.8" rotation="0 180 0" class="clickable">
      <a-plane width="2" height="0.8" color="#CF2027">
        <a-text value="EXIT" align="center" position="0 0 0.01" color="#FFFFFF" width="4"></a-text>
      </a-plane>
    </a-entity>

    <!-- WRIST BUTTON (Toggle Control Panel) - Attached to left wrist -->
    <a-entity id="wrist-button" position="-0.1 0 -0.05" visible="false">
      <a-cylinder radius="0.04" height="0.015" color="#CF2027" 
        class="clickable panel-toggle"
        animation__pulse="property: scale; to: 1.1 1.1 1.1; dur: 500; dir: alternate; loop: true">
        <a-text value="MENU" position="0 0.02 0" align="center" color="#FFFFFF" width="0.3" rotation="-90 0 0"></a-text>
      </a-cylinder>
    </a-entity>

    <!-- CONTROL PANEL (Hidden initially, toggles with wrist button) -->
    <a-entity id="control-panel" visible="false" position="0 0 0">
      <a-plane position="0 0 -0.4" rotation="-45 0 0" width="0.4" height="0.5" color="#2B2B88" opacity="0.95" material="side: double">
        <a-text value="CONTROLS" position="0 0.21 0.01" align="center" color="#FFFFFF" width="1"></a-text>
        
        <!-- HELP Button -->
        <a-plane id="panel-help" class="clickable panel-button" position="0 0.1 0.01" width="0.32" height="0.08" color="#CF2027">
          <a-text value="HELP" align="center" position="0 0 0.01" color="#FFFFFF" width="1"></a-text>
        </a-plane>
        
        <!-- MENU Button -->
        <a-plane id="panel-menu" class="clickable panel-button" position="0 0 0.01" width="0.32" height="0.08" color="#5CCAE8">
          <a-text value="MENU" align="center" position="0 0 0.01" color="#FFFFFF" width="1"></a-text>
        </a-plane>
        
        <!-- EXIT Button -->
        <a-plane id="panel-exit" class="clickable panel-button" position="0 -0.1 0.01" width="0.32" height="0.08" color="#B78A2D">
          <a-text value="EXIT" align="center" position="0 0 0.01" color="#FFFFFF" width="1"></a-text>
        </a-plane>
        
        <!-- Movement Arrows -->
        <a-text value="MOVE" position="0 -0.19 0.01" align="center" color="#FFFFFF" width="0.7"></a-text>
        
        <!-- Forward Arrow -->
        <a-plane id="move-forward" class="clickable move-button" position="0 -0.26 0.01" width="0.06" height="0.06" color="#5CCAE8">
          <a-text value="^" align="center" position="0 0 0.01" color="#FFFFFF" width="0.5"></a-text>
        </a-plane>
        
        <!-- Backward Arrow -->
        <a-plane id="move-back" class="clickable move-button" position="0 -0.36 0.01" width="0.06" height="0.06" color="#5CCAE8">
          <a-text value="v" align="center" position="0 0 0.01" color="#FFFFFF" width="0.5"></a-text>
        </a-plane>
        
        <!-- Left Arrow -->
        <a-plane id="move-left" class="clickable move-button" position="-0.08 -0.31 0.01" width="0.06" height="0.06" color="#5CCAE8">
          <a-text value="<" align="center" position="0 0 0.01" color="#FFFFFF" width="0.5"></a-text>
        </a-plane>
        
        <!-- Right Arrow -->
        <a-plane id="move-right" class="clickable move-button" position="0.08 -0.31 0.01" width="0.06" height="0.06" color="#5CCAE8">
          <a-text value=">" align="center" position="0 0 0.01" color="#FFFFFF" width="0.5"></a-text>
        </a-plane>
      </a-plane>
    </a-entity>

    <!-- MENU PLANT (LEFT) -->
    <a-entity id="menu-plant" position="-8 0 -8" class="clickable">
      <a-cylinder position="0 0.3 0" radius="0.6" height="0.6" color="#8B4513"></a-cylinder>
      <a-entity 
        gltf-model="#plant-model" 
        position="0 0.6 0" 
        scale="0.7 0.7 0.7" 
        rotation="0 45 0">
      </a-entity>
      <a-text 
        value="MENU" 
        position="0 2.2 0"
        align="center"
        color="#2B2B88"
        width="8">
      </a-text>
    </a-entity>

    <!-- HELP PLANT (RIGHT) -->
    <a-entity id="help-plant" position="8 0 -8" class="clickable">
      <a-cylinder position="0 0.3 0" radius="0.6" height="0.6" color="#8B4513"></a-cylinder>
      <a-entity 
        gltf-model="#plant-model" 
        position="0 0.6 0" 
        scale="0.7 0.7 0.7" 
        rotation="0 -45 0">
      </a-entity>
      <a-text 
        value="HELP" 
        position="0 2.2 0"
        align="center"
        color="#CF2027"
        width="8">
      </a-text>
    </a-entity>

    <!-- MENU CARD -->
    <a-entity id="menu-card" position="-3 1.6 -5" visible="false">
      <a-plane width="3" height="4" color="#FFFFFF" opacity="0.95" material="side: double"></a-plane>
      
      <a-text value="MENU" position="0 1.7 0.05" align="center" color="#2B2B88" width="5"></a-text>
      
      <a-plane class="menu-link" position="0 1.0 0.05" width="2.5" height="0.5" color="#5CCAE8">
        <a-text value="View Projections" align="center" position="0 0 0.01" color="#FFFFFF" width="4"></a-text>
      </a-plane>
      
      <a-plane class="menu-link" position="0 0.3 0.05" width="2.5" height="0.5" color="#5CCAE8">
        <a-text value="Section Views" align="center" position="0 0 0.01" color="#FFFFFF" width="4"></a-text>
      </a-plane>
      
      <a-plane class="menu-link" position="0 -0.4 0.05" width="2.5" height="0.5" color="#5CCAE8">
        <a-text value="Dimensioning" align="center" position="0 0 0.01" color="#FFFFFF" width="4"></a-text>
      </a-plane>
      
      <a-plane class="menu-link" position="0 -1.1 0.05" width="2.5" height="0.5" color="#5CCAE8">
        <a-text value="Tolerances" align="center" position="0 0 0.01" color="#FFFFFF" width="4"></a-text>
      </a-plane>
      
      <a-plane id="menu-close" class="clickable" position="-1.2 1.7 0.05" width="0.5" height="0.5" color="#CF2027">
        <a-text value="X" align="center" position="0 0 0.01" color="#FFFFFF" width="3"></a-text>
      </a-plane>
    </a-entity>

    <!-- HELP CARD -->
    <a-entity id="help-card" position="3 1.6 -5" visible="false">
      <a-plane width="3" height="4" color="#FFFFFF" opacity="0.95" material="side: double"></a-plane>
      
      <a-text value="HELP" position="0 1.7 0.05" align="center" color="#CF2027" width="5"></a-text>
      
      <a-text 
        value="Controls:\n\nPinch to grab model\nMove hand to rotate\nBring hands together\nto scale\n\nWalk to move around" 
        position="0 0.3 0.05"
        align="center"
        color="#2B2B88"
        width="2.5"
        wrap-count="25">
      </a-text>
      
      <a-plane id="help-close" class="clickable" position="-1.2 1.7 0.05" width="0.5" height="0.5" color="#CF2027">
        <a-text value="X" align="center" position="0 0 0.01" color="#FFFFFF" width="3"></a-text>
      </a-plane>
    </a-entity>

    <!-- ENGINEERING MODEL -->
    <a-entity 
      id="model-container" 
      position="0 1.6 -2.5"
      grabbable>
      
      <a-entity id="engineering-model" scale="0.4 0.4 0.4">
        
        <!-- Main Body -->
        <a-box position="0 0 0" width="1.2" height="0.8" depth="0.8" color="#F5F5F5"></a-box>
        <a-box position="0 0 0" width="1.21" height="0.81" depth="0.81" 
          material="color: #000000; wireframe: true; wireframeLinewidth: 3"></a-box>
        
        <!-- Cylindrical Feature -->
        <a-cylinder position="0 0 0.42" radius="0.25" height="0.08" color="#F5F5F5"></a-cylinder>
        <a-cylinder position="0 0 0.42" radius="0.255" height="0.085"
          material="color: #000000; wireframe: true; wireframeLinewidth: 3"></a-cylinder>
        
        <!-- Side Extension -->
        <a-box position="0.7 0 0" width="0.4" height="0.6" depth="0.6" color="#F5F5F5"></a-box>
        <a-box position="0.7 0 0" width="0.41" height="0.61" depth="0.61"
          material="color: #000000; wireframe: true; wireframeLinewidth: 3"></a-box>
        
        <!-- Top Cylinder -->
        <a-cylinder position="0 0.5 0" radius="0.3" height="0.3" color="#F5F5F5"></a-cylinder>
        <a-cylinder position="0 0.5 0" radius="0.305" height="0.305"
          material="color: #000000; wireframe: true; wireframeLinewidth: 3"></a-cylinder>
        
        <!-- Corner Detail -->
        <a-box position="-0.5 -0.3 0.3" width="0.2" height="0.2" depth="0.2" color="#F5F5F5"></a-box>
        <a-box position="-0.5 -0.3 0.3" width="0.21" height="0.21" depth="0.21"
          material="color: #000000; wireframe: true; wireframeLinewidth: 3"></a-box>
        
        <!-- Vertices -->
        <a-sphere position="0.6 0.4 0.4" radius="0.04" color="#000000"></a-sphere>
        <a-sphere position="0.6 0.4 -0.4" radius="0.04" color="#000000"></a-sphere>
        <a-sphere position="0.6 -0.4 0.4" radius="0.04" color="#000000"></a-sphere>
        <a-sphere position="0.6 -0.4 -0.4" radius="0.04" color="#000000"></a-sphere>
        <a-sphere position="-0.6 0.4 0.4" radius="0.04" color="#000000"></a-sphere>
        <a-sphere position="-0.6 0.4 -0.4" radius="0.04" color="#000000"></a-sphere>
        <a-sphere position="-0.6 -0.4 0.4" radius="0.04" color="#000000"></a-sphere>
        <a-sphere position="-0.6 -0.4 -0.4" radius="0.04" color="#000000"></a-sphere>
        <a-sphere position="0.9 0.3 0.3" radius="0.04" color="#000000"></a-sphere>
        <a-sphere position="0.9 0.3 -0.3" radius="0.04" color="#000000"></a-sphere>
        <a-sphere position="0.9 -0.3 0.3" radius="0.04" color="#000000"></a-sphere>
        <a-sphere position="0.9 -0.3 -0.3" radius="0.04" color="#000000"></a-sphere>
      </a-entity>

      <a-text 
        id="view-label"
        value="Front View" 
        position="0 1.2 0"
        align="center"
        color="#2B2B88"
        width="5">
      </a-text>
    </a-entity>

    <!-- CAMERA RIG WITH HAND TRACKING -->
    <a-entity id="rig" position="0 0 0">
      <a-entity id="camera" camera position="0 1.6 0" look-controls="pointerLockEnabled: false">
        <a-cursor color="#2B2B88" fuse="true" fuse-timeout="500" 
          raycaster="objects: .clickable, .panel-button, .move-button, .menu-link, .panel-toggle; far: 10"></a-cursor>
      </a-entity>
      
      <!-- HAND TRACKING CONTROLS -->
      <a-entity 
        id="left-hand" 
        hand-tracking-controls="hand: left; modelColor: #5CCAE8"
        hand-tracking-grab-controls="grabCooldownTime: 200"
        raycaster="objects: .clickable, .panel-button, .move-button, .menu-link, .panel-toggle, [grabbable]; far: 5">
      </a-entity>
      
      <a-entity 
        id="right-hand" 
        hand-tracking-controls="hand: right; modelColor: #CF2027"
        hand-tracking-grab-controls="grabCooldownTime: 200"
        raycaster="objects: .clickable, .panel-button, .move-button, .menu-link, .panel-toggle, [grabbable]; far: 5">
      </a-entity>
    </a-entity>
  </a-scene>

  <script>
    let vrActive = false;
    let viewCycleInterval = null;
    let currentView = 0;
    let isInteracting = false;
    let lastInteractionTime = 0;
    let panelVisible = false;

    const views = [
      {name: 'Front View', rotation: {x: 0, y: 0, z: 0}},
      {name: 'Top View', rotation: {x: 90, y: 0, z: 0}},
      {name: 'Side View', rotation: {x: 0, y: 90, z: 0}},
      {name: 'Isometric View', rotation: {x: 35.26, y: 45, z: 0}}
    ];

    // Wrist button toggle
    function toggleControlPanel() {
      panelVisible = !panelVisible;
      const panel = document.getElementById('control-panel');
      panel.setAttribute('visible', panelVisible);
    }

    // Update wrist button and panel position to follow left hand
    function updateWristUI() {
      if (!vrActive) return;
      
      const leftHand = document.getElementById('left-hand');
      const wristButton = document.getElementById('wrist-button');
      const controlPanel = document.getElementById('control-panel');
      
      if (!leftHand || !leftHand.object3D) return;
      
      // Show wrist button when hand is tracked
      wristButton.setAttribute('visible', true);
      
      // Position wrist button on left wrist
      const handPos = leftHand.object3D.position;
      const handRot = leftHand.object3D.rotation;
      
      wristButton.object3D.position.copy(handPos);
      wristButton.object3D.rotation.copy(handRot);
      
      // Position control panel in front of left hand when visible
      if (panelVisible) {
        controlPanel.object3D.position.copy(handPos);
        controlPanel.object3D.rotation.copy(handRot);
      }
    }

    setInterval(updateWristUI, 50);

    // Start button
    document.getElementById('start-btn').addEventListener('click', function() {
      document.getElementById('intro-overlay').classList.add('hidden');
      setTimeout(() => {
        document.getElementById('intro-overlay').style.display = 'none';
        document.getElementById('vr-scene').style.display = 'block';
        vrActive = true;
        startViewCycle();
      }, 800);
    });

    // View cycling
    function startViewCycle() {
      if (viewCycleInterval) clearInterval(viewCycleInterval);
      viewCycleInterval = setInterval(() => {
        const now = Date.now();
        // Check if 10 seconds have passed since last interaction
        if (!isInteracting && (now - lastInteractionTime > 10000 || lastInteractionTime === 0)) {
          currentView = (currentView + 1) % views.length;
          const view = views[currentView];
          const model = document.getElementById('engineering-model');
          const label = document.getElementById('view-label');
          
          label.setAttribute('value', view.name);
          model.setAttribute('animation', {
            property: 'rotation',
            to: `${view.rotation.x} ${view.rotation.y} ${view.rotation.z}`,
            dur: 1200,
            easing: 'easeInOutQuad'
          });
        }
      }, 3000);
    }

    function stopViewCycle() {
      isInteracting = true;
      lastInteractionTime = Date.now();
      document.getElementById('view-label').setAttribute('value', 'Interactive Mode');
      document.getElementById('view-label').setAttribute('color', '#CF2027');
    }

    function resumeViewCycle() {
      isInteracting = false;
      lastInteractionTime = Date.now();
      document.getElementById('view-label').setAttribute('color', '#2B2B88');
    }

    // Exit button
    document.getElementById('exit-button').addEventListener('click', handleExit);
    
    function handleExit() {
      document.getElementById('vr-scene').style.display = 'none';
      document.getElementById('intro-overlay').style.display = 'flex';
      document.getElementById('intro-overlay').classList.remove('hidden');
      vrActive = false;
      if (viewCycleInterval) clearInterval(viewCycleInterval);
    }

    // Panel buttons
    document.getElementById('wrist-button').addEventListener('click', toggleControlPanel);
    
    document.getElementById('panel-help').addEventListener('click', function() {
      document.getElementById('model-container').setAttribute('visible', false);
      document.getElementById('help-card').setAttribute('visible', true);
      toggleControlPanel();
    });

    document.getElementById('panel-menu').addEventListener('click', function() {
      document.getElementById('model-container').setAttribute('visible', false);
      document.getElementById('menu-card').setAttribute('visible', true);
      toggleControlPanel();
    });

    document.getElementById('panel-exit').addEventListener('click', handleExit);

    // Movement buttons
    const moveSpeed = 0.5;
    
    document.getElementById('move-forward').addEventListener('click', function() {
      const rig = document.getElementById('rig');
      const camera = document.getElementById('camera');
      const pos = rig.getAttribute('position');
      const rot = camera.getAttribute('rotation').y * Math.PI / 180;
      
      pos.x -= Math.sin(rot) * moveSpeed;
      pos.z -= Math.cos(rot) * moveSpeed;
      rig.setAttribute('position', pos);
    });

    document.getElementById('move-back').addEventListener('click', function() {
      const rig = document.getElementById('rig');
      const camera = document.getElementById('camera');
      const pos = rig.getAttribute('position');
      const rot = camera.getAttribute('rotation').y * Math.PI / 180;
      
      pos.x += Math.sin(rot) * moveSpeed;
      pos.z += Math.cos(rot) * moveSpeed;
      rig.setAttribute('position', pos);
    });

    document.getElementById('move-left').addEventListener('click', function() {
      const rig = document.getElementById('rig');
      const camera = document.getElementById('camera');
      const pos = rig.getAttribute('position');
      const rot = camera.getAttribute('rotation').y * Math.PI / 180;
      
      pos.x -= Math.cos(rot) * moveSpeed;
      pos.z += Math.sin(rot) * moveSpeed;
      rig.setAttribute('position', pos);
    });

    document.getElementById('move-right').addEventListener('click', function() {
      const rig = document.getElementById('rig');
      const camera = document.getElementById('camera');
      const pos = rig.getAttribute('position');
      const rot = camera.getAttribute('rotation').y * Math.PI / 180;
      
      pos.x += Math.cos(rot) * moveSpeed;
      pos.z -= Math.sin(rot) * moveSpeed;
      rig.setAttribute('position', pos);
    });

    // Menu plant click
    document.getElementById('menu-plant').addEventListener('click', function() {
      document.getElementById('model-container').setAttribute('visible', false);
      document.getElementById('menu-card').setAttribute('visible', true);
    });

    // Help plant click
    document.getElementById('help-plant').addEventListener('click', function() {
      document.getElementById('model-container').setAttribute('visible', false);
      document.getElementById('help-card').setAttribute('visible', true);
    });

    // Menu close
    document.getElementById('menu-close').addEventListener('click', function() {
      document.getElementById('menu-card').setAttribute('visible', false);
      document.getElementById('model-container').setAttribute('visible', true);
    });

    // Help close
    document.getElementById('help-close').addEventListener('click', function() {
      document.getElementById('help-card').setAttribute('visible', false);
      document.getElementById('model-container').setAttribute('visible', true);
    });

    // Card background click to close
    document.getElementById('menu-card').addEventListener('click', function(evt) {
      if (evt.target === this.querySelector('a-plane')) {
        document.getElementById('menu-card').setAttribute('visible', false);
        document.getElementById('model-container').setAttribute('visible', true);
      }
    });

    document.getElementById('help-card').addEventListener('click', function(evt) {
      if (evt.target === this.querySelector('a-plane')) {
        document.getElementById('help-card').setAttribute('visible', false);
        document.getElementById('model-container').setAttribute('visible', true);
      }
    });

    // Menu links (placeholder)
    document.querySelectorAll('.menu-link').forEach(link => {
      link.addEventListener('click', function() {
        console.log('Menu item clicked:', this.querySelector('a-text').getAttribute('value'));
      });
    });

    // Model grab interaction - properly handle grabbable component
    const modelContainer = document.getElementById('model-container');
    const model = document.getElementById('engineering-model');
    
    // Listen to A-Frame's grabbable events
    modelContainer.addEventListener('grab-start', function() {
      stopViewCycle();
    });

    modelContainer.addEventListener('grab-end', function() {
      resumeViewCycle();
    });

    // Also listen for hand tracking pinch events as backup
    const leftHand = document.getElementById('left-hand');
    const rightHand = document.getElementById('right-hand');
    
    let grabbedByHand = false;
    
    leftHand.addEventListener('pinchstarted', function(evt) {
      // Check if raycaster is hitting the model
      const intersections = evt.target.components.raycaster.intersectedEls;
      if (intersections.includes(modelContainer)) {
        grabbedByHand = true;
        stopViewCycle();
      }
    });
    
    leftHand.addEventListener('pinchended', function() {
      if (grabbedByHand) {
        grabbedByHand = false;
        resumeViewCycle();
      }
    });
    
    rightHand.addEventListener('pinchstarted', function(evt) {
      const intersections = evt.target.components.raycaster.intersectedEls;
      if (intersections.includes(modelContainer)) {
        grabbedByHand = true;
        stopViewCycle();
      }
    });
    
    rightHand.addEventListener('pinchended', function() {
      if (grabbedByHand) {
        grabbedByHand = false;
        resumeViewCycle();
      }
    });

    // WASD movement for desktop/testing
    const rig = document.getElementById('rig');
    const speed = 0.1;
    const keys = {};

    document.addEventListener('keydown', (e) => { keys[e.key.toLowerCase()] = true; });
    document.addEventListener('keyup', (e) => { keys[e.key.toLowerCase()] = false; });

    setInterval(() => {
      if (!vrActive) return;
      const pos = rig.getAttribute('position');
      const camera = document.getElementById('camera');
      const rotation = camera.getAttribute('rotation').y * Math.PI / 180;

      if (keys['w']) {
        pos.x -= Math.sin(rotation) * speed;
        pos.z -= Math.cos(rotation) * speed;
      }
      if (keys['s']) {
        pos.x += Math.sin(rotation) * speed;
        pos.z += Math.cos(rotation) * speed;
      }
      if (keys['a']) {
        pos.x -= Math.cos(rotation) * speed;
        pos.z += Math.sin(rotation) * speed;
      }
      if (keys['d']) {
        pos.x += Math.cos(rotation) * speed;
        pos.z -= Math.sin(rotation) * speed;
      }

      rig.setAttribute('position', pos);
    }, 16);
  </script>
</body>
</html>